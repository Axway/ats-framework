<!doctype html>
<html>
 <head> 
  <title>ATS : File System Snapshots</title> 
  <link rel="stylesheet" href="styles/site.css" type="text/css"> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
 </head> 
 <body class="theme-default aui-theme-default"> 
  <div id="page"> 
   <div id="main" class="aui-page-panel"> 
    <div id="main-header"> 
     <a><img class="axway_logo" src="images/AxwayLogo.png" alt="Axway Inc"></a> 
     <div id="breadcrumb-section"> 
      <ol id="breadcrumbs"> 
       <li class="first"> <span><a href="index.html">ATS</a></span> </li> 
       <li> <span><a href="ATS-Documentation.html">ATS Documentation</a></span> </li> 
       <li> <span><a href="ATS-Guide.html">ATS Guide</a></span> </li> 
       <li> <span><a href="Basic-functionalities.html">Basic functionalities</a></span> </li> 
      </ol> 
     </div> 
     <h1 id="title-heading" class="pagetitle"> <span id="title-text"> ATS : File System Snapshots </span> </h1> 
    </div> 
    <div id="content" class="view"> 
     <div id="main-content" class="wiki-content group"> 
      <h1 id="FileSystemSnapshots-Introduction">Introduction</h1> 
      <p>In some cases you might be interested to know what changes were made on some file system.</p> 
      <p>The regular example is when you want to test whether an upgrade of your Application Under Test did not cause any unwanted changes on the file system.</p> 
      <p>&nbsp;</p> 
      <hr> 
      <h1 id="FileSystemSnapshots-Makesurethereisnochangeonthefilesystem">Make sure there is no change on the file system</h1> 
      <p>The following example makes a snapshot of some directory, then the real testing work (this could be a product upgrade for example) is done which might change this directory. Then another snapshot is made and both snapshots are compared.</p> 
      <p>All files and sub-directories of the pointed directory are checked and they must match - otherwise an error is thrown and the test fails</p> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <pre class="syntaxhighlighter-pre" data-theme="Confluence">import com.axway.ats.action.filesystem.snapshot.FileSystemSnapshot;
...
// take first snapshot
FileSystemSnapshot snapshot1 = new FileSystemSnapshot( "snap1" );
snapshot1.addDirectory( "F1", "C:/dir1" );
snapshot1.takeSnapshot();

// DO SOME REAL WORK

// take second snapshot
FileSystemSnapshot snapshot2 = new FileSystemSnapshot( "snap2" );
snapshot2.addDirectory( "F1", "C:/dir1" );
snapshot2.takeSnapshot();

// check both snapshots are same
snapshot1.compare( snapshot2 );
</pre> 
       </div> 
      </div> 
      <div class="confluence-information-macro has-no-icon confluence-information-macro-note"> 
       <div class="confluence-information-macro-body"> 
        <p>As usual, when you want to take a snapshot on a remote host, there is constructor which takes an extra parameter which is the ATS Agent address</p> 
       </div> 
      </div> 
      <div class="confluence-information-macro confluence-information-macro-information"> 
       <p class="title">Monitoring more than one directory</p> 
       <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span> 
       <div class="confluence-information-macro-body"> 
        <p>You can freely add as many directories as needed by using the <em>addDirectory</em> method.</p> 
       </div> 
      </div> 
      <div class="confluence-information-macro confluence-information-macro-note"> 
       <p class="title">Snapshot alias</p> 
       <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span> 
       <div class="confluence-information-macro-body"> 
        <p>The snapshot name in the constructor is used when printing messages and errors, so try to provide a good name here</p> 
       </div> 
      </div> 
      <div class="confluence-information-macro confluence-information-macro-note"> 
       <p class="title">Directory alias</p> 
       <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span> 
       <div class="confluence-information-macro-body"> 
        <p>The first argument of the <em>addDirectory</em> method is a directory alias. This is mandatory parameter and is used to distinguish the directory pairs between both snapshots. This is case sensitive argument so make sure to keep the case for all method calls or better use a constant in the test code.</p> 
        <p>In some cases the name of monitored directories might change and that is why we need this alias name. For example you might be monitoring directory "C:/Programs/MyProductInstallDir_version1" from first snapshot and "C:/Programs/MyProductInstallDir_version5" from second snapshot - in this case the directory alias will tell us this is a pair of directories to check</p> 
       </div> 
      </div> 
      <p>&nbsp;</p> 
      <hr> 
      <h1 id="FileSystemSnapshots-Donotchecksomeinternalfileordirectory">Do not check some internal file or directory</h1> 
      <p>Some of the snapshot content might not be of interest as it is expected to get changed</p> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <pre class="syntaxhighlighter-pre" data-theme="Confluence">// take first snapshot
final String F1 = "dir1-alias";
FileSystemSnapshot snapshot1 = new FileSystemSnapshot( "snap1" );
snapshot1.addDirectory( F1, "C:/dir1" );
snapshot1.skipDirectory( F1, "sub-dir1/not_important_dir" );
snapshot1.skipDirectoryByRegex( F1, "sub-dir1/sub_[0-9]_[a-z]"); // skip directory by Regex (only the last directory token can be a Regex)
snapshot1.skipFile( F1, "sub-dir2/changing_file.xml" );
snapshot1.takeSnapshot();

// DO SOME REAL WORK

// take second snapshot
FileSystemSnapshot snapshot2 = new FileSystemSnapshot( "snap2" );
snapshot2.addDirectory( F1, "C:/dir1" );
snapshot2.takeSnapshot();

// check both snapshots are same without the entities that are to be skipped
snapshot1.compare( snapshot2 );
</pre> 
       </div> 
      </div> 
      <p>In this example we will not check <em>not_important_dir</em> and <em>changing_file.xml</em>. It does not matter if they are different between both snapshots, or they do not even exist - we will simply not deal with them.</p> 
      <div class="confluence-information-macro confluence-information-macro-information"> 
       <p class="title">Path to nested entities</p> 
       <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span> 
       <div class="confluence-information-macro-body"> 
        <p>When pointing to a nested file or directory, you provide the path to them starting from the path of the root directory (one added with addDirectory() method).<br> You also must specify which root directory they belong to by using the right directory alias.</p> 
       </div> 
      </div> 
      <p>&nbsp;</p> 
      <hr> 
      <h1 id="FileSystemSnapshots-Pointsomefileofinterestbyusingaregularexpression">Point some file of interest by using a regular expression</h1> 
      <p>If for example want to skip more than one file, you can provide a regular expression instead of a static file name</p> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <pre class="syntaxhighlighter-pre" data-theme="Confluence">snapshot1.skipFileByRegex( "F1", "sub-dir2/changing_file.*" );
</pre> 
       </div> 
      </div> 
      <p>In this case all files in the pointed sub-directory which name starts with <em>changing_file</em> will be skipped.</p> 
      <p>&nbsp;</p> 
      <hr> 
      <h1 id="FileSystemSnapshots-Skipjustsomefileattributesofafile">Skip just some file attributes of a file</h1> 
      <p>There might be a case where you want to check a file is present, but you do not want to check its <em>size</em> and <em>last modification time</em> for example</p> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <pre class="syntaxhighlighter-pre" data-theme="Confluence">snapshot1.skipFile( "F1", "sub-dir2/changing_file.xml", FileSystemSnapshot.SKIP_FILE_SIZE, FileSystemSnapshot.SKIP_FILE_MODIFICATION_TIME );
</pre> 
       </div> 
      </div> 
      <p>This way you can provide a list with the not important file attributes</p> 
      <div class="confluence-information-macro confluence-information-macro-tip"> 
       <p class="title">Supported file attributes</p> 
       <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span> 
       <div class="confluence-information-macro-body"> 
        <p>The list of file attributes might grow in future.<br> All available values are available through constants starting with <em>FileSystemSnapshot.SKIP_FILE_</em></p> 
       </div> 
      </div> 
      <p>&nbsp;</p> 
      <hr> 
      <h1 id="FileSystemSnapshots-Skipsomefileattributesofallfiles">Skip some file attributes of all files</h1> 
      <p>You can configure globally some file attributes to be skipped or not by using the <em>ActionLibraryConfigurator</em> class</p> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <pre class="syntaxhighlighter-pre" data-theme="Confluence">ActionLibraryConfigurator.getInstance().setFileSnapshotCheckModificationTime( false );
</pre> 
       </div> 
      </div> 
      <p>This way all <em>modification times</em> of all files are going to be ignored</p> 
      <div class="confluence-information-macro confluence-information-macro-tip"> 
       <span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span> 
       <div class="confluence-information-macro-body"> 
        <p>Use the different ActionLibraryConfigurator.getInstance().getFileSnapshot* and ActionLibraryConfigurator.getInstance().setFileSnapshot* methods to see all the available options.</p> 
        <p>By default all checks are enabled.</p> 
       </div> 
      </div> 
      <p>&nbsp;</p> 
      <hr> 
      <h1 id="FileSystemSnapshots-Skipafileattributeglobally,butstillcheckitonafewfiles?">Skip a file attribute globally, but still check it on a few files?</h1> 
      <p>The following example gives two ways to achieve it:</p> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <pre class="syntaxhighlighter-pre" data-theme="Confluence">// globally disable the modification time attribute
ActionLibraryConfigurator.getInstance().setFileSnapshotCheckModificationTime( false );

// first way - specify explicitly this attribute is important for this file
snapshot1.checkFile( "F1", "important_file.xml", FileSystemSnapshot.CHECK_FILE_MODIFICATION_TIME );

// second way - specify all supported attributes are important for this file
snapshot1.checkFile( "F1", "important_file.xml" );
</pre> 
       </div> 
      </div> 
      <p>&nbsp;</p> 
      <hr> 
      <h1 id="FileSystemSnapshots-Keepthesnapshotintoinafile">Keep the snapshot into in a file</h1> 
      <p>You can persist the snapshot into an XML file and retrieve it when needed.</p> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <pre class="syntaxhighlighter-pre" data-theme="Confluence">FileSystemSnapshot snapshot1 = new FileSystemSnapshot( "snap1" );
snapshot1.addDirectory( "F1", "C:/dir1" );
snapshot1.takeSnapshot();
snapshot1.toLocalFile( "C:/snapshot_file_for_product_version1.xml" );
</pre> 
       </div> 
      </div> 
      <p>The above code makes a snapshot of the file system and saves it into a file. Imagine a new product version came to test, now you can make sure the file system is same as with the previous version.</p> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <pre class="syntaxhighlighter-pre" data-theme="Confluence">// load the old snapshot info from the backup file
FileSystemSnapshot oldSnapshot = FileSystemSnapshot.fromLocalFile( "product version 1", "C:/snapshot_file_for_product_version1.xml");

// make a new snapshot which reflects the current product version
FileSystemSnapshot newSnapshot = new FileSystemSnapshot( "product version 2" );
newSnapshot.addDirectory( "F1", "C:/dir1" );
newSnapshot.takeSnapshot();

// compare both snapshots
newSnapshot.compare( oldSnapshot );
</pre> 
       </div> 
      </div> 
      <div class="confluence-information-macro confluence-information-macro-information"> 
       <p class="title">Local and Remote files</p> 
       <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span> 
       <div class="confluence-information-macro-body"> 
        <p><em>toLocalFile</em> and <em>fromLocalFile</em> methods work on the local host</p> 
        <p>In similar way you can use <em>toRemoteFile</em> and <em>fromRemoteFile</em> methods from remote host</p> 
       </div> 
      </div> 
      <p>&nbsp;</p> 
      <hr> 
      <h1 id="FileSystemSnapshots-Maketwoidenticalsnapshotswithoutduplicatingthecode">Make two identical snapshots without duplicating the code</h1> 
      <p>In real life you may need to use lots of methods in order to describe properly all the files and directories that are to be checked and this will lead to longer code than the presented in this guide.<br> If you need to have 2 snapshots with same internal structure, but only taken at a different time, you will need to duplicate a lot of code.</p> 
      <p>Instead of repeating the same long code for the second snapshot, you can use a handy method:</p> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <pre class="syntaxhighlighter-pre" data-theme="Confluence">// create the initial snapshot
FileSystemSnapshot snapshot1 = new FileSystemSnapshot( "snap1" );
snapshot1.addDirectory( "F1", "C:/dir1" );
snapshot1.addDirectory( "F2", "C:/dir2" );
snapshot1.addDirectory( "F3", "C:/dir3" );
snapshot1.skipDirectory( "F1", "sub-dir1/not_important_dir" );
snapshot1.skipDirectory( "F1", "sub-dir2/not_important_dir" );
snapshot1.skipDirectory( "F1", "sub-dir1/another_not_important_dir" );
snapshot1.skipFile( "F1", "sub-dir2/changing_file.xml" );
snapshot1.skipFile( "F1", "sub-dir1/.*xml" );
snapshot1.takeSnapshot();

// create the second snapshot
FileSystemSnapshot snapshot2 = snapshot1.newSnapshot( "snap2" );
snapshot2.takeSnapshot();

// now compare them
snapshot1.compare( snapshot2);&nbsp;</pre> 
       </div> 
      </div> 
      <p><br></p> 
      <hr> 
      <h1 id="FileSystemSnapshots-Comparesomefiles'contentinsteadoftheirfileattributes">Compare some files' content instead of their file attributes</h1> 
      <p>Imagine you have some human readable configuration file. The file got changed in a way that a line is moved a little down or a new white space character appeared. We tell you it is a different file(as long as it size and MD5 checksum do not match), but you tell us the files have same content indeed.</p> 
      <p><a href="File-System-Snapshots---Inspect-the-content-of-some-file-types.html">Here</a> is how to deal with such files. Currently this includes XML, Properties, INI and plain TEXT files.</p> 
      <p><br></p> 
      <hr> 
      <h1 id="FileSystemSnapshots-Makeyourownreportaboutthefounddifferences">Make your own report about the found differences</h1> 
      <p>If you do not like the way we present the found differences, you can make your own:</p> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <pre class="syntaxhighlighter-pre" data-theme="Confluence">import com.axway.ats.common.filesystem.snapshot.FileSystemSnapshotException;
import com.axway.ats.common.filesystem.snapshot.equality.EqualityState;
import com.axway.ats.common.filesystem.snapshot.equality.FileTrace;

// make both snapshots as described in the previous sections of this page

try {
    // compare both snapshots
    snapshot2.compare( snapshot1 );
} catch ( FileSystemSnapshotException e ) {
    // if not expected differences are found, you will get this exception
    // you catch it here so can extract the differences out of the exception
    FileSystemEqualityState equalityState = e.getEqualityState();

    // now use the available method to get the list of differences and construct your own report style
    List&lt;FileTrace&gt; differentFiles = equalityState.getDifferentFiles();
    List&lt;FileTrace&gt; filesInOneSnapshotOnly = equalityState.getFilesPresentInOneSnapshotOnly( "snap1" );
    List&lt;FileTrace&gt; directoriesInOneSnapshotOnly= equalityState.getDirectoriesPresentInOneSnapshotOnly( "snap1" );

    // inspect FileTrace getter methods to extract the needed info
}</pre> 
       </div> 
      </div> 
      <p>&nbsp;</p> 
      <hr> 
      <p>Back to <a href="Basic-functionalities.html">parent page</a><p>Go to <a href="./toc.html">Table of Contents</a></p></p> 
      <hr> 
     </div> 
    </div> 
   </div> 
  </div>   
 </body>
</html>