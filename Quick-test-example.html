<!DOCTYPE html>
<html>
    <head>
        <title>ATS : Quick test example</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">ATS</a></span>
                            </li>
                                                    <li>
                                <span><a href="ATS-OS-Documentation.html">ATS OS Documentation</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            ATS : Quick test example
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nikolay Gogovski</span>, last modified on Mar 15, 2017
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>Please read this example carefully. There are a lot of comments which will help you get a good idea on what it is doing.</p><p>Note that some important topics are following this test code.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">    import com.axway.ats.action.filesystem.FileSystemOperations;
    import com.axway.ats.action.filetransfer.FileTransferClient;
    import com.axway.ats.action.rest.RestClient;
    import com.axway.ats.action.rest.RestMediaType;
    import com.axway.ats.action.rest.RestResponse;
    import com.axway.ats.common.filetransfer.TransferProtocol;

    /**
     * 1. Configuration - Get the remote home folder of a user using a REST call
     * 
     * 2. Action - Send a file using this user&#39;s credential
     * 
     * 3. Verification - Make sure the file was received in the user&#39;s home folder
     */
    @Test
    public void getUserHomeFolderAndSendFileOverFtp() {

        // 1. Configuration
        // Instantiate the Rest client by providing the remote URL
        RestClient restClient = new RestClient( SERVER_BASE_REST_URL + &quot;demo/gethome&quot; );

        // Issue a GET command, provide user first and last name.
        // If user exists, the server will respond back with status 200 and body containing the user&#39;s home folder in JSON content
        RestResponse restResponse = restClient.addRequestParameter( &quot;firstName&quot;, &quot;Jackie&quot; )
                                              .addRequestParameter( &quot;lastName&quot;, &quot;Chan&quot; )
                                              .setResponseMediaType( RestMediaType.APPLICATION_JSON )
                                              .get();
        // verify we received the expected status code
        assertEquals( 200, restResponse.getStatusCode() );

        // extract the user&#39;s home folder
        String userHome = restResponse.getBodyAsJson().getString( &quot;home&quot; );
        assertNotNull( userHome );

        // 2. Action
        // Instantiate the File Transfer client by providing protocol, remote IP, user name and password
        FileTransferClient transferClient = new FileTransferClient( TransferProtocol.FTP );
        transferClient.connect( SERVER_IP, &quot;jchan&quot;, &quot;password&quot; );

        // upload a local file to the remote root folder of our user
        transferClient.uploadFile( LOCAL_FILE_LOCATION + FILE_NAME, &quot;/&quot; );

        // disconnect the File Transfer client
        transferClient.disconnect();

        // 3. Verification
        // Instantiate the File System Operations client by providing the remote ATS Agent address
        FileSystemOperations fileSystemClient = new FileSystemOperations( ATS_AGENT_ON_SERVER );

        // Check the existence of the expected remote file
        boolean fileExists = fileSystemClient.doesFileExist( userHome + FILE_NAME );
        assertTrue( fileExists, &quot;File &quot; + FILE_NAME + &quot; was not found in the user&#39;s home folder&quot; );
    }</pre>
</div></div><h1 id="Quicktestexample-Whatisthistestdoing?">What is this test doing?</h1><p>As you can see this test contains three parts:</p><ol><li>Issue a REST GET call to our server(also called Tested Application). <br/>For the provided first and last user names, the server responds back with some JSON body which contains the home of the user.</li><li>We establish a FTP connection to our server and upload a local file to it.</li><li>We do not believe our server(otherwise we wouldn't test it), so we want to verify it has saved the uploaded file into the user's home folder.</li></ol><h1 id="Quicktestexample-WhataretheusedATSclasses?">What are the used ATS classes?</h1><p><strong> <em>RestClient</em> </strong>is the class capable of running REST calls. Beside the mandatory URL, you can specify headers, query parameters, content type etc.</p><p>After running the HTTP method(in our example we do a GET) you always get a <strong> <em>RestResponse</em> </strong>which allows you to inspect the response. You can check the status code or response headers. In our case we also need to extract data from the response body and since this is a JSON body, we specify the path (the <em>&quot;home&quot;</em> key) to the needed data. This data is used at the end of the scenario.</p><p>The <strong> <em>FileTransferClient</em> </strong>is a simple client which supports uploads and downloads over variety of transfer protocols.</p><p><strong> <em>FileSystemOperations</em> </strong>allows doing different tasks on the file system. In our case we simply check whether some file(the uploaded one) is present in some folder on the server side. Since the server side is a remote host, we need to provide in the constructor the address of the remote ATS agent(TODO: make it a link). The ATS agent is a stand alone ATS application which allows our test example to do file operations on a remote host.</p><div class="confluence-information-macro has-no-icon confluence-information-macro-note"><p class="title">Test constants</p><div class="confluence-information-macro-body"><p>To make the test running, you will need to assign valid values to all used constants</p></div></div><h1 id="Quicktestexample-Whyistheexamplebrokenintothreeparts?">Why is the example broken into three parts?</h1><p>We think that most test scenarios can be broken into three significant parts or <em>phases</em>:</p><ol><li><strong> <em>Configuration</em> </strong>. <br/>These are the preparation steps to make the environment appropriate for having the test run as expected.</li><li><strong> <em>Action</em> </strong>. <br/>These are the actual test steps, they materialize the meaning of the test. This is the core of the test code.</li><li><strong> <em>Verification</em> </strong>. <br/>This is a very important part which is often underestimated. It is used to assure the action phase passed as expected or not. Here you will define whether we got a success or failure.<br/>Imagine in our example we are able to send the file over FTP without errors and then we conclude the upload was successful, so the test pass. What if the server consumed the file and did not save it in the user's home folder?<br/>For such cases we can make a separate check without relying on the server opinion. We do it in the verification phase.</li></ol><h1 id="Quicktestexample-Whatifsomethinggowrong?">What if something go wrong?</h1><p>This test will fail if some error happen during the step executions. For example if provide wrong username, the file transfer step will throw a java exception containing the failure reason.</p><p>Another failure option is if some of the <em>asserts</em> in the code are not satisfied, in such case again a java exception will be thrown explaining difference between the expected and actually received values.</p><p>Â </p><hr/><p>Back to <a href="ATS-OS-Documentation.html">parent page</a></p><hr/>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Apr 04, 2017 09:30</p>
                    <div id="footer-logo"></div>
                </section>
            </div>
        </div>     </body>
</html>


