<!doctype html>
<html>
 <head> 
  <title>ATS : Attach a file to the current testcase</title> 
  <link rel="stylesheet" href="styles/site.css" type="text/css"> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
 </head> 
 <body class="theme-default aui-theme-default"> 
  <div id="page"> 
   <div id="main" class="aui-page-panel"> 
    <div id="main-header"> 
     <a><img class="axway_logo" src="images/AxwayLogo.png" alt="Axway Inc"></a> 
     <div id="breadcrumb-section"> 
      <ol id="breadcrumbs"> 
       <li class="first"> <span><a href="index.html">ATS</a></span> </li> 
       <li> <span><a href="ATS-Documentation.html">ATS Documentation</a></span> </li> 
       <li> <span><a href="ATS-Guide.html">ATS Guide</a></span> </li> 
       <li> <span><a href="Test-logging.html">Test logging</a></span> </li> 
      </ol> 
     </div> 
     <h1 id="title-heading" class="pagetitle"> <span id="title-text"> ATS : Attach a file to the current testcase </span> </h1> 
    </div> 
    <div id="content" class="view"> 
     <div id="main-content" class="wiki-content group"> 
      <h1 id="Attachafiletothecurrenttestcase-Introduction">Introduction</h1> 
      <hr> 
      <p>It is possible to attach some file to the current test case. This way you can check the file content from within your testcase in Test Explorer.</p> 
      <p>Imagine while testing your server you want at some moment to have its log file. Now you can attach this file to the testcase, so while reviewing the testcase data you can also see the content of that log file.</p> 
      <p><br></p> 
      <hr> 
      <h1 id="Attachafiletothecurrenttestcase-Usage">Usage</h1> 
      <p>All you need to do is to run code like the following:</p> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <pre class="syntaxhighlighter-pre" data-theme="Confluence">import com.axway.ats.log.AtsDbLoggerUtilities;

new AtsDbLoggerUtilities().attachFileToCurrentTest( "C:\\logFiles\\log.txt", "TestExplorer-4.0.5", 8080 );
</pre> 
       </div> 
      </div> 
      <p>where</p> 
      <ul style="list-style-type: square;"> 
       <li>the first argument is the <em>absolute file location</em> on the local file system</li> 
       <li>the second argument is <em>the name of the TestExplorer application context</em> e.g. for <a class="external-link" href="http://192.168.1.100/TestExplorer-4.0.2" rel="nofollow">http://192.168.1.100:8080/TestExplorer-4.0.5</a> the TestExplorer's context name is "<em> <span style="line-height: 1.42857;">TestExplorer-4.0.5</span> </em>". The Test Explorer hostname is automatically resolved from your <em>log4j.xml</em> where you have already defined for DB logging settings.</li> 
       <li>an optional third argument is the port at which Test Explorer is running. If not specified, the default value used is 80</li> 
      </ul> 
      <p><br></p> 
      <hr> 
      <h1 id="Attachafiletothecurrenttestcase-HereishowitmightlooklikeinTestExplorer:">Here is how it might look like in Test Explorer:</h1> 
      <p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/119484917/119484924.png" data-unresolved-comment-count="0" data-linked-resource-version="1" data-linked-resource-default-alias="pic1.png" data-linked-resource-content-type="image/png" data-linked-resource-container-version="14"></span></p> 
      <p>As you can see we have an additional <em>Attachments</em> panel.</p> 
      <p>If you click on a button with the name of your file, its content is displayed. Of course this is meaningful for text files.</p> 
      <p>No matter if the file is text or binary, you can always download the file by clicking its link so can examine it with an appropriate viewer on your PC.</p> 
      <p><br></p> 
      <hr> 
      <h1 id="Attachafiletothecurrenttestcase-Filesizeconsiderations">File size considerations</h1> 
      <p>Currently the max file size supported is 10MB</p> 
      <p>If your file is larger, we recommend that you either get only the last N lines or take just the new lines. ATS code is already available to achieve this</p> 
      <h3 id="Attachafiletothecurrenttestcase-GetjustthelastNlinesfromthelogfile">Get just the last N lines from the log file</h3> 
      <p><br></p> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <pre class="syntaxhighlighter-pre" data-theme="Confluence"> FileSystemOperations op = new FileSystemOperations();

 // getting the last 100 lines from the desired file
 String[] fileLastLines = op.getLastLinesFromFile( "C:\\logFiles\\log.txt", 100 );

 // combining all array elements into one String
 StringBuilder fileContent = new StringBuilder();
 for( String line : fileLastLines ) {
    fileContent.append( line );
    fileContent.append( "\n" );
 }

 // creating the file, that will contain the last 100 lines
 File logChunk = new File( "C:\\logFiles\\logChunk.txt" );
 // make the file to be deleted, after the operation ends
 logChunk.deleteOnExit();
 
 // Save the content into a new file on the system. There are many ways to do this. Talk with us if need assistance
 // ...
 // ...

 // and now attaching the new smaller file
 boolean isAttachedOk = new AtsDbLoggerUtilities().attachFileToCurrentTest( logChunk, "TestExplorer-4.0.5" );
 // if needed, you can check whether the file was attached successfully</pre> 
       </div> 
      </div> 
      <p><br></p> 
      <h3 id="Attachafiletothecurrenttestcase-Getjustthenewlinesfromatextfile(assumingthisissometypicalgrowinglogfile)">Get just the new lines from a text file(assuming this is some typical growing log file)</h3> 
      <p><br></p> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <pre class="syntaxhighlighter-pre" data-theme="Confluence">        String originalFile = "C:\\logFiles\\log.txt";
        FileSystemOperations op = new FileSystemOperations();

        // in the beginning of the test read all current file lines
        FileMatchInfo fileLastLines = op.findNewTextInFile( originalFile, ".*",true);
        StringBuilder fileContent = new StringBuilder();
      
	  	// Here the test is running. The log is growing and at some point you want to get the new lines only
        // ...
        // ...

        // read the new lines since the last read
        fileLastLines = op.findNewTextInFile( originalFile, ".*", true);        
        
        // combining all array elements into one String
        for( String line : fileLastLines.lines) {
            fileContent.append( line );
            fileContent.append( "\n" );
        }
        
        File logChunk = new File( "C:\\logChunk.txt" );
        // Save the content into a new file on the system. There are many ways to do this. Talk with us if need assistance
        // ...
        // ...

        // and now attaching the new file which contains the new lines only
        boolean isAttachedOk = new AtsDbLoggerUtilities().attachFileToCurrentTest( logChunk, "TestExplorer-4.0.5" );
        // if needed, you can check whether the file was attached successfully</pre> 
       </div> 
      </div> 
      <p><br></p> 
      <hr> 
      <h1 id="Attachafiletothecurrenttestcase-Attachingafiletoaspecifictestcase">Attaching a file to a specific testcase</h1> 
      <p>By default, the file will be attached to the currently running testcase.</p> 
      <p>However, there might be cases when you want to attach the file after the test has already completed, so there isn't a current testcase. In such case you can get the ID of the last executed testcase and give it to the attach method:</p> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <pre class="syntaxhighlighter-pre" data-theme="Confluence">// get the the ID of the last executed testcase as it is in the Test Explorer DB
int lastExecutedTestcaseId = ActiveDbAppender.getCurrentInstance().getLastExecutedTestCaseId();

// now call the attach method
new AtsDbLoggerUtilities().attachFileToTestcase( lastExecutedTestcaseId, "C:\\logFiles\\log.txt", "TestExplorer-4.0.5" );</pre> 
       </div> 
      </div> 
      <p><br></p> 
      <p><br></p> 
      <hr> 
      <p>Back to <a href="Test-logging.html">parent page</a><p>Go to <a href="./toc.html">Table of Contents</a></p></p> 
      <hr> 
     </div> 
    </div> 
   </div> 
  </div>  
 </body>
</html>