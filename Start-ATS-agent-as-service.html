<!DOCTYPE html>
<html>
    <head>
        <title>ATS : Start ATS agent as service</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">ATS</a></span>
                            </li>
                                                    <li>
                                <span><a href="ATS-OS-Documentation.html">ATS OS Documentation</a></span>
                            </li>
                                                    <li>
                                <span><a href="ATS-Guide.html">ATS Guide</a></span>
                            </li>
                                                    <li>
                                <span><a href="The-ATS-Agent.html">The ATS Agent</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            ATS : Start ATS agent as service
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nikolay Gogovski</span>, last modified on Mar 31, 2017
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 id="StartATSagentasservice-Introduction">Introduction</h1><p>Read this page if you want to have the Agent up and running as soon as the system starts.</p><p> </p><hr/><h1 id="StartATSagentasservice-InWindows">In Windows</h1><p>Can be done it two ways</p><h3 id="StartATSagentasservice-ByusingScheduledTask">By using Scheduled Task</h3><ol><li>Open <em>Control Panel -&gt; Scheduled Tasks</em> and click <em>Add Scheduled Task</em></li><li>Fill the Task tab like this one:<br/> <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/119486084/119486096.png" data-image-src="attachments/119486084/119486096.png" data-unresolved-comment-count="0" data-linked-resource-id="119486096" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="pic1.png" data-base-url="https://techweb.axway.com/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="119486084" data-linked-resource-container-version="5"></span> <br/> Make sure you are using local user as you might have problems with domain users.</li><li>On the Schedule tab select &quot;At System Startup&quot;<br/> <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/119486084/119486097.png" data-image-src="attachments/119486084/119486097.png" data-unresolved-comment-count="0" data-linked-resource-id="119486097" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="pic2.png" data-base-url="https://techweb.axway.com/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="119486084" data-linked-resource-container-version="5"></span></li><li>On the Settings tab is important to cleanup/uncheck underlined checkbox as by default it is checked to stop process after 72 Hours.<br/> <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/119486084/119486098.png" data-image-src="attachments/119486084/119486098.png" data-unresolved-comment-count="0" data-linked-resource-id="119486098" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="pic3.png" data-base-url="https://techweb.axway.com/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="119486084" data-linked-resource-container-version="5"></span></li></ol><h4 id="StartATSagentasservice-BycreatingaWindowsservice">By creating a Windows service</h4><p>The following steps describe how to start the ATS Agent as a service. They are written for Windows 2008 Server. For other versions there may be some differences.</p><ol><li><p>Open CMD and execute the folloowing command:<br/> &lt;path&gt;\INSTSRV.EXE 'My Service Name' &lt;path&gt;\SRVANY.EXE<br/> For example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">C:\Program Files (x86)\Windows Resource Kit\Tools\instsrv.exe ATSAgent C:\Program Files (x86)\Windows Resource Kit\Tools\Srvany.exe
</pre>
</div></div><p>You will get a message that service is successfully created.</p></li><li>Open <strong>regedit</strong> and find <em>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\ATSAgent</em></li><li>From the <em>Edit</em> menu, click <em>Add Key</em>. Type 'Parameters' for key name.</li><li>From the <em>Edit</em> menu, click <em>Add Value</em>. Set Value name to 'Application'</li><li>Right click <em>Modify</em> and set Value data to the path where your ATS agent.bat file is. For example: C:\ats\auto-agent\agent.bat</li><li><p>Specify the full java path in the agent.bat file:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">:: the java executable
@SET JAVA_EXEC=C:\PROGRA~2\Java\jdk1.7.0_17\jre\bin\java
</pre>
</div></div></li></ol><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>You can also refer to the following Microsoft KB article for running a script as a service on Windows:<br/> <a class="external-link" href="http://support.microsoft.com/kb/137890" rel="nofollow">http://support.microsoft.com/kb/137890</a></p></div></div><h3 id="StartATSagentasservice-Alternatives">Alternatives</h3><p><a class="external-link" href="http://nssm.cc/usage" rel="nofollow">NSSM - the Non-Sucking Service Manager</a> <br/> <a class="external-link" href="http://runasservice.sourceforge.net/Manual.html" rel="nofollow">RunAsService</a></p><p> </p><hr/><h1 id="StartATSagentasservice-In*nix(withinitsystemmanager)">In *nix (with <em>init</em> system manager)</h1><hr/><h3 id="StartATSagentasservice-RedHat,SUSE,Solaris,(K|U)buntu,Mint">Red Hat, SUSE, Solaris, (K|U)buntu, Mint</h3><ol><li><p>Create init script in <strong>/etc/init.d</strong>, eg. atsAgent with the absolute path to the agent.sh file:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>/etc/init.d/atsAgent</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">#!/bin/sh
/ats/agent.sh $@
</pre>
</div></div><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Do not use symbolic links (ln -s) to the agent.sh script. Currently the agent.sh script has a problem to locate the agent path for all *nix systems using links.</p></div></div></li><li><p>Set <em>X</em> privileges</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">chmod a+x /etc/init.d/atsAgent
</pre>
</div></div><p>You can test the script by running: <em>/etc/init.d/atsAgent status|version</em></p></li><li>Add the script for automatic startup</li></ol><ul class="alternate"><li><p>1-st define the correct run level. You can check the your current run level by executing <strong>runlevel</strong> command.<br/> In short the run levels are separated in this way:</p><div class="table-wrap"><table class="wrapped confluenceTable"><tbody><tr><th class="confluenceTh"><p>Run Level</p></th><th class="confluenceTh"><p>Generic</p></th><th class="confluenceTh"><p>Fedora Core</p></th><th class="confluenceTh"><p>Slackware</p></th><th class="confluenceTh"><p>Debian</p></th></tr><tr><td class="confluenceTd"><p>0</p></td><td class="confluenceTd"><p>Halt</p></td><td class="confluenceTd"><p>Halt</p></td><td class="confluenceTd"><p>Halt</p></td><td class="confluenceTd"><p>Halt</p></td></tr><tr><td class="confluenceTd"><p>1</p></td><td class="confluenceTd"><p>Single-user mode</p></td><td class="confluenceTd"><p>Single-user mode</p></td><td class="confluenceTd"><p>Single-user mode</p></td><td class="confluenceTd"><p>Single-user mode</p></td></tr><tr><td class="confluenceTd"><p>2</p></td><td class="confluenceTd"><p>Basic multi-user mode (without networking)</p></td><td class="confluenceTd"><p>User definable (Unused)</p></td><td class="confluenceTd"><p>User definable - configured the same as runlevel 3</p></td><td class="confluenceTd"><p>Multi-user mode</p></td></tr><tr><td class="confluenceTd"><p>3</p></td><td class="confluenceTd"><p>Full (text based) multi-user mode</p></td><td class="confluenceTd"><p>Multi-user mode</p></td><td class="confluenceTd"><p>Multi-user mode - default Slackware runlevel</p></td><td class="confluenceTd"> </td></tr><tr><td class="confluenceTd"><p>4</p></td><td class="confluenceTd"><p>Not used</p></td><td class="confluenceTd"><p>Not used</p></td><td class="confluenceTd"><p>X11 with KDM/GDM/XDM (session managers)</p></td><td class="confluenceTd"><p>Multi-user mode</p></td></tr><tr><td class="confluenceTd"><p>5</p></td><td class="confluenceTd"><p>Full (GUI based) multi-user mode</p></td><td class="confluenceTd"><p>Full multi-user mode (with an X-based login screen) - default runlevel</p></td><td class="confluenceTd"><p>User definable - configured the same as runlevel 3</p></td><td class="confluenceTd"><p>Multi-user mode</p></td></tr><tr><td class="confluenceTd"><p>6</p></td><td class="confluenceTd"><p>Reboot</p></td><td class="confluenceTd"><p>Reboot</p></td><td class="confluenceTd"><p>Reboot</p></td><td class="confluenceTd"><p>Reboot</p></td></tr></tbody></table></div></li></ul><ul class="alternate"><li><p>Now create a symbolic link to the init script in the <strong>/etc/rc&lt;runlevel_number&gt;.d/</strong> (in SUSE Linux it is /etc/rc.d/rc&lt;runlevel_number&gt;.d/).<br/> The link name must start with <strong>S</strong> (means that the script is called with &quot;start&quot; argument) followed by a two-digit number (startup order - from the lowest to the highest) and the script name.<br/> For example if you want to add it in runlevel 2, type the following command:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">ln -s /etc/init.d/atsAgent /etc/rc2.d/S20atsAgent

# in SUSE
ln -s /etc/init.d/atsAgent /etc/rc.d/rc2.d/S20atsAgent
</pre>
</div></div></li></ul><p>The other option is using <em>sysv-rc-conf</em> command. After creating the init script, run the <em>sysv-rc-conf</em> command and mark the desired runlevel (mark <em>S</em> option too).</p><h3 id="StartATSagentasservice-Troubleshooting">Troubleshooting</h3><ul class="alternate"><li><p>If the service is not started check the nohup.out file in ATS Agent <em>/logs</em> folder. A message like &quot;failed to run command `java': No such file or directory&quot; means that the <em>java</em> binary is not in the <em>PATH</em> environment variable. Possible solution is to export the PATH and JAVA_HOME from the service script file (before calling <em>agent.sh</em>)</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">#!/bin/sh
export PATH=${PATH}:/usr/java/jre/bin
export JAVA_HOME=/usr/java/jre
/ats/agent.sh $@
</pre>
</div></div></li></ul><p> </p><hr/><p>Back to <a href="The-ATS-Agent.html">parent page</a></p><hr/>
                    </div>

                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Apr 04, 2017 09:30</p>
                    <div id="footer-logo"></div>
                </section>
            </div>
        </div>     </body>
</html>


