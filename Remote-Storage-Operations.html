<!doctype html>
<html>
 <head> 
  <title>ATS : Remote Storage Operations</title> 
  <link rel="stylesheet" href="styles/site.css" type="text/css"> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
 </head> 
 <body class="theme-default aui-theme-default"> 
  <div id="page"> 
   <div id="main" class="aui-page-panel"> 
    <div id="main-header"> 
     <a><img class="axway_logo" src="images/AxwayLogo.png" alt="Axway Inc"></a> 
     <div id="breadcrumb-section"> 
      <ol id="breadcrumbs"> 
       <li class="first"> <span><a href="index.html">ATS</a></span> </li> 
       <li> <span><a href="ATS-Documentation.html">ATS Documentation</a></span> </li> 
       <li> <span><a href="ATS-Guide.html">ATS Guide</a></span> </li> 
       <li> <span><a href="Basic-functionalities.html">Basic functionalities</a></span> </li> 
      </ol> 
     </div> 
     <h1 id="title-heading" class="pagetitle"> <span id="title-text"> ATS : Remote Storage Operations </span> </h1> 
    </div> 
    <div id="content" class="view"> 
     <div id="main-content" class="wiki-content group"> 
      <h1 id="RemoteStorageOperations-Introduction">Introduction</h1> 
      <p><br></p> 
      <p>ATS provides support for operations over <a class="external-link" href="https://aws.amazon.com/s3/" rel="nofollow">Amazon Simple Storage Service</a> (S3 storage) and compatible services. You may use <strong><em>S3Operations</em> </strong>for direct tasks. Current list of these tasks include:</p> 
      <ul style="list-style-type: square;"> 
       <li><span>bucket operations - check for existence, create and delete;<br></span></li> 
       <li><span>object operations:<br></span> 
        <ul style="list-style-type: square;"> 
         <li><span>upload, download files/objects;</span></li> 
         <li><span>list remote objects;</span></li> 
         <li><span>move (rename), delete objects;</span></li> 
         <li><span>get attributes which includes size, modification time, checksum (MD5/ETag);<br></span></li> 
        </ul></li> 
      </ul> 
      <p><span>Below are details how to implement such operations.</span></p> 
      <h1 id="RemoteStorageOperations-Initialization">Initialization</h1> 
      <div> 
       <div class="syntaxhighlighter sh-confluence nogutter java"> 
        <p><br></p> 
        <p>In order to use ATS S3Operations client you must add into tour classpath the <em>ats-s3-utilities</em> library. For Maven you should add this dependency in your <em>pom.xml</em> file:</p> 
        <div class="code panel pdl" style="border-width: 1px;"> 
         <div class="codeContent panelContent pdl"> 
          <pre class="syntaxhighlighter-pre" data-theme="Confluence">    &lt;dependency&gt;
        &lt;groupId&gt;com.axway.ats.framework.utilities&lt;/groupId&gt;
        &lt;artifactId&gt;ats-s3-utilities&lt;/artifactId&gt;
        &lt;version&gt;${ats.version}&lt;/version&gt; &lt;!-- Refers property with exact ATS version like 4.0.3 --&gt;
    &lt;/dependency&gt;</pre> 
         </div> 
        </div> 
        <p><br></p> 
        <p>Then you may create instance of S3Operations client:</p> 
        <div class="table-wrap"> 
         <table class="wrapped confluenceTable"> 
          <colgroup> 
           <col> 
          </colgroup> 
          <tbody> 
           <tr> 
            <td class="confluenceTd"> 
             <div class="content-wrapper"> 
              <div class="container" title="Hint: double-click to select code"> 
               <div class="code panel pdl" style="border-width: 1px;"> 
                <div class="codeContent panelContent pdl"> 
                 <pre class="syntaxhighlighter-pre" data-theme="Confluence">import com.axway.ats.action.s3.S3Operations; // part of ats-s3-utilities library
...
S3Operations s3OperationsClient = new S3Operations( endpoint, accessKey, secretKey, region, bucketName);</pre> 
                </div> 
               </div> 
              </div> 
             </div></td> 
           </tr> 
          </tbody> 
         </table> 
        </div> 
        <p class="auto-cursor-target">Where parameters are:</p> 
        <ul style="list-style-type: square;"> 
         <li><strong>endpoint</strong> is the URL to the instance/server (URL with host and optional port like 12.34.56.78:5678) where S3 storage is set up and running. For Amazon S3 you may refer to this <a class="external-link" href="https://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region" rel="nofollow">endpoints table</a>. Example: <em>s3.eu-west-1.amazonaws.com</em></li> 
         <li><strong>access key</strong> part of credentials</li> 
         <li><strong>secret key</strong> part of credentials</li> 
         <li><strong>region</strong> name related to the endpoint property. Refer to documentation. Example: <em>eu-west-1</em></li> 
         <li><strong>bucket name</strong> the name of the bucket you want to work with. It might be not created yet. For naming conventions you may refer to <a class="external-link" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/BucketRestrictions.html" rel="nofollow">this document</a>. Notice that bucket name should be unique and could not be reused between different customers in same endpoint/region.</li> 
        </ul> 
       </div> 
      </div> 
      <h1 id="RemoteStorageOperations-Examples">Examples</h1> 
      <p><br></p> 
      <p>Below is example of what you can do with this utility. For the full list please check the source code or JavaDoc.</p> 
      <div class="code panel pdl" style="border-width: 1px;"> 
       <div class="codeContent panelContent pdl"> 
        <pre class="syntaxhighlighter-pre" data-theme="Confluence">import com.axway.ats.action.s3.S3Operations;
import com.axway.ats.action.s3.S3ObjectInfo;
...

// Make an instance of this class to work with bucket named "my-ats-example"
S3Operations s3Ops =  new S3Operations( "s3.eu-west-1.amazonaws.com", accessKey, secretKey, 
                                       "eu-west-1", "my-ats-example");

// use clean bucket
if (s3Ops.doesBucketExist()) {
   s3Ops.deleteBucket();
}
s3Ops.createBucket();

// upload file
s3Ops.upload("destFile.txt", "localFile.txt");

// compare checksums to make sure file is uploaded and not corrupted
String remoteMd5 = s3Ops.getFileMD5(destFile);
Assert.assertEquals(remoteMd5, localFileMd5 /* use FileSystemOperations for this */, 
                    "MD5 of uploaded file does not match expected " + localFileMd5); 

// single call to get many attributes
S3ObjectInfo summary = s3Ops.getFileMetadata("destFile.txt"); 
long fileSize = summary.getSize(); // in bytes
String remoteMd5 = summary.getMd5(); 
Date fileDate = summary.getLastModified(); // get last modification time of this object

// delete all objects in bucket. Effective even for large set of objects to be deleted. 
s3Ops.deleteObjects("" /* or null, no prefix path to be matched */, ".*" /* match all names */, true /* search recursively in nested paths */);
</pre> 
       </div> 
      </div> 
      <p>Note that Amazon emulates folders by accepting separator character. ATS considers it to be the default, UNIX folder separator ("/", forward slash). However in order to root directory, the path prefix should be just empty string.</p> 
      <p><br></p> 
      <hr> 
      <h1 id="RemoteStorageOperations-Specialconsiderations">Special considerations</h1> 
      <p><br></p> 
      <p>Working with remote files is tricky and you should consider optional concurrency cases. This could be true especially if you use ATS to verify that other system had already uploaded some file. In such case it is recommended to use polling and particularly our RBV client <em>named S3Verification</em>. More details are described in <a href="Remote-Storage-(S3)-Verifications.html">Remote Storage (S3) Verifications</a>.</p> 
      <p><br></p> 
      <hr> 
      <p>Back to <a href="Basic-functionalities.html">parent page</a><p>Go to <a href="./toc.html">Table of Contents</a></p></p> 
      <hr> 
     </div> 
    </div> 
   </div> 
  </div>  
 </body>
</html>